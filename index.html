<!DOCTYPE html>
<html>
  <head>
    <!-- <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" /> -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css"
    integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
    integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg="
    crossorigin=""></script>
    <style>
      #map {position: absolute; top: 0; right: 0; bottom: 0; left: 0;}
    </style>
  </head>
  <body>
    <div id="map"> </div>
    <script src="data/isInProgram_0.js"></script>
    <script src="data/hasSchoolYardNotInProgramActual_3.js"></script>
    <script src="data/playgrounds_coords_7.js"></script>
    <script>
        // ASK ZHI-- not sure what's wrong with this code but something is breaking the map from loading
        // is it because I didn't return map at the end?
        // const settings = {
        // maxZoom: 20,
        // minZoom: 11,
        // bounds: L.latLngBounds([40.496133, -74.2555913], [40.9155327, -73.30078125])
        // };
    
        // const map = L.map(mapContainer, { ...settings }).setView([40.67, -73.85], 11);
    
        // L.tileLayer(
        // 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png',
        // {
        //     ...settings,
        //     attribution:
        //     'Carto | &copy; <a href="http://osm.org/copyright">OSM</a> contributors'
        // }
        // ).addTo(map);

        const map = L.map('map').setView([40.67, -73.85], 11);
    
        let baseMap = L.tileLayer(
        'https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png',
        {   
            maxZoom: 20,
            minZoom: 11,
            bounds: L.latLngBounds([40.496133, -74.2555913], [40.9155327, -73.30078125]),
            attribution:
            'Carto | &copy; <a href="http://osm.org/copyright">OSM</a> contributors'
        }
        ).addTo(map);

        // you can't see them markers with this code
        // function createMarker(feature, latlng) {
        //     const style = `
        //         background-color:${feature.properties.color};
        //         border-radius: 0.2em;
        //         margin-right: 0.2em;
        //         border: 1px solid #FFF;
        //         height: inherit;
        //         width: inherit;
        //         display: inherit;
        //     `;
    
        //     const icon = L.divIcon({
        //         className: 'leaflet-icon',
        //         html: `<span style='${style}'></span>`,
        //         iconSize: [8, 8],
        //         iconAnchor: [5, 5]
        //     });
        //     return L.marker(latlng, { icon });
        // }
    
        // let layer = L.geoJSON(json_isInProgram_0.features, {
        //     pointToLayer: createMarker,
        //         onEachFeature: (feature, layer) => {
        //             if (feature.properties && feature.properties.label) {
        //                 layer.bindPopup(feature.properties.label, {
        //                     closeButton: false,
        //                     autoPan: false,
        //                     offset: L.point(0, 0)
        //                 });
        //             }
        //         }
        //     }).addTo(map);

        let notInProgramMarkerStyle = {
            radius: 3,
            fillColor: "#FF7F50",
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        };

        let isInProgramMarkerStyle = {
            radius: 3,
            fillColor: "#008080",
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        };

        let playgroundsMarkerStyle = {
            radius: 3,
            fillColor: "#FFD700",
            color: "#000",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        };

        let isInProgram = L.geoJSON(json_isInProgram_0.features, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, isInProgramMarkerStyle);
            },
            onEachFeature: (feature, layer) => {
                if (feature.properties && feature.properties.Primary_Address) {
                    layer.bindPopup(feature.properties.Primary_Address, {
                        autoPan: false,
                        offset: L.point(0, 0)
                    });
                }
            }
        }).addTo(map);

        let notInProgram = L.geoJSON(json_hasSchoolYardNotInProgramActual_3, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, notInProgramMarkerStyle);
            },
            onEachFeature: (feature, layer) => {
                if (feature.properties && feature.properties.Primary_Address) {
                    layer.bindPopup(feature.properties.Primary_Address, {
                        autoPan: false,
                        offset: L.point(0, 0)
                    });
                }
            }
        }).addTo(map);

        let playgrounds = L.geoJSON(json_playgrounds_coords_7, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, playgroundsMarkerStyle);
            },
            onEachFeature: (feature, layer) => {
                if (feature.properties && feature.properties.Name) {
                    layer.bindPopup(feature.properties.Name, {
                        autoPan: false,
                        offset: L.point(0, 0)
                    });
                }
            }
        }).addTo(map);

        let baseMaps = {
            "Carto Base Map": baseMap
        };

        let overlayMaps = {
            "In Program": isInProgram,
            "Not In Program": notInProgram,
            "Playgrounds": playgrounds
        };

        let layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);

        // can't see markers with createMarker
        // L.geoJSON(json_isInProgram_0.features, {
        //     pointToLayer: createMarker 
        // }).addTo(map);

            
        // invalidation.then(() => map.remove());
            
            // do I need to make map an object and return this in order for the code to work?
            // return map;

    </script>
  </body>
</html>
